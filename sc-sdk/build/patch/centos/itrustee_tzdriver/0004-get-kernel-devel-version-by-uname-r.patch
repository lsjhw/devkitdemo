Subject: [PATCH] get kernel devel version by uname -r
---
Index: Makefile
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Makefile b/Makefile
--- a/Makefile	(revision 3600bb022b22c32a10474aa8693c60bb7f326fb5)
+++ b/Makefile	(revision f682cd55fe571e6b7382291eced791a60c49c4d3)
@@ -19,7 +19,7 @@
 
 # you should config right path according to your run-time environment
 KPATH := /usr/src/kernels
-KERNEL_VERSION := $(shell rpm -qa|grep kernel-devel | sort | head -n 1 | awk -F "kernel-devel-" '{print $$2}')
+KERNEL_VERSION := $(shell uname -r)
 KDIR  := $(KPATH)/$(KERNEL_VERSION)
 
 GCC_VERSION := $(shell expr `gcc -dumpversion | cut -f1 -d.`)
@@ -31,7 +31,7 @@
 KERNEL_MATCH := $(findstring $(KERNEL_VERSION), $(KERNEL_VERSION_LIST))
 
 ifeq ("$(GCC_VERSION)_$(KERNEL_VERSION)", "$(GCC_MATCH)_$(KERNEL_MATCH)")
-    $(error "Require gcc version >= 10.")
+    $(error "Require gcc version >= 10, current gcc version is $(GCC_VERSION). If you install in a custom directory, please add a soft link pointing to the gcc binary in the /usr/bin directory.")
 endif
 
 EXTRA_CFLAGS += -fstack-protector-strong -DCONFIG_TEELOG -DCONFIG_TZDRIVER_MODULE -DCONFIG_TEECD_AUTH -DCONFIG_PAGES_MEM=y -DCONFIG_AUTH_ENHANCE -DCONFIG_CLOUDSERVER_TEECD_AUTH
