Subject: [PATCH] add link to so
---
Index: Makefile
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Makefile b/Makefile
--- a/Makefile	(revision b21a213637013232526165638b9e6be6370e6248)
+++ b/Makefile	(revision e9b019ba24a2f2c3978e7a74a0e5c31c453eaec8)
@@ -1,9 +1,11 @@
-TARGET_LIB := libteec.so
+TARGET_LIB := libteec.so.1
 TARGET_APP := teecd
 TARGET_DIR := dist
 LIBC_SEC   := libboundscheck
 TARGET_LOG := tlogcat
-TARGET_LIBSEC := libboundscheck.so
+TARGET_LIBSEC := libboundscheck.so.1
+
+TARGET_LIB_SO_NAME := libteec.so
 
 LIB_CFLAGS := -DDYNAMIC_TA_PATH=\"/var/itrustee/ta/\"
 LIB_CFLAGS += -Iinclude -Iinclude/cloud -Iext_include -Ilibboundscheck/include -Iinclude -Isrc/inc  -Isrc/authentication/
@@ -39,10 +41,13 @@
 
 $(TARGET_LIB):$(TARGET_LIBSEC) $(LIB_SOURCES)
 	@echo "compile libteec.so"
-	@$(CC) $(LIB_CFLAGS) $(LIB_CFLAGS) -o $@ $(LIB_SOURCES)
+	@$(CC) $(LIB_CFLAGS) $(LIB_CFLAGS) -Wl,-soname,$(TARGET_LIB_SO_NAME) -o $@ $(LIB_SOURCES)
+	@ln -s libteec.so.1 libteec.so
 	@mkdir -p $(TARGET_DIR)
+	@mv libteec.so.1 $(TARGET_DIR)
 	@mv libteec.so $(TARGET_DIR)
-	@cp $(LIBC_SEC)/lib/libboundscheck.so $(TARGET_DIR)
+	@cp $(LIBC_SEC)/lib/libboundscheck.so.1 $(TARGET_DIR)
+	@cp -d $(LIBC_SEC)/lib/libboundscheck.so $(TARGET_DIR)
 	@echo "after compile libteec.so"
 
 
